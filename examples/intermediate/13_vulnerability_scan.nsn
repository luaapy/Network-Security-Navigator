# NSN Example: Vulnerability Scan

# Perform a simple vulnerability scan on a target host by
# combining a port scan with basic service fingerprinting.

import security.scanner as scanner
import network.http as http
import network.tcp as tcp

host = "192.168.1.100"
ports = "1-1024"

print "Scanning " + host + " for open ports..."
open_ports = scanner.scan(host, ports)

if len(open_ports) == 0 {
    print "No open ports found on " + host
    exit 0
}

print "Open ports found: " + str(open_ports)

# Simple service detection based on common ports
for port in open_ports {
    if port == 80 or port == 8080 {
        resp = http.get("http://" + host + ":" + str(port) + "/")
        print "Port " + str(port) + " - HTTP service (status " + str(resp.status_code) + ")"
    } elif port == 22 {
        print "Port " + str(port) + " - SSH service"
    } elif port == 443 {
        print "Port " + str(port) + " - HTTPS service"
    } else {
        # Attempt banner grab via TCP socket
        sock = tcp.connect(host, port)
        if sock != null {
            sock.send("\r\n")
            banner = sock.recv(256)
            print "Port " + str(port) + " - Banner: " + banner
            sock.close()
        } else {
            print "Port " + str(port) + " - Unknown service"
        }
    }
}

print "Vulnerability scan complete."
